{"contents":"'use strict';\nvar debug = __fusereq(23)('express:router:route');\nvar flatten = __fusereq(27);\nvar Layer = __fusereq(31);\nvar methods = __fusereq(21);\nvar slice = Array.prototype.slice;\nvar toString = Object.prototype.toString;\nmodule.exports = Route;\nfunction Route(path) {\n  this.path = path;\n  this.stack = [];\n  debug('new %o', path);\n  this.methods = {};\n}\nRoute.prototype._handles_method = function _handles_method(method) {\n  if (this.methods._all) {\n    return true;\n  }\n  var name = method.toLowerCase();\n  if (name === 'head' && !this.methods['head']) {\n    name = 'get';\n  }\n  return Boolean(this.methods[name]);\n};\nRoute.prototype._options = function _options() {\n  var methods = Object.keys(this.methods);\n  if (this.methods.get && !this.methods.head) {\n    methods.push('head');\n  }\n  for (var i = 0; i < methods.length; i++) {\n    methods[i] = methods[i].toUpperCase();\n  }\n  return methods;\n};\nRoute.prototype.dispatch = function dispatch(req, res, done) {\n  var idx = 0;\n  var stack = this.stack;\n  if (stack.length === 0) {\n    return done();\n  }\n  var method = req.method.toLowerCase();\n  if (method === 'head' && !this.methods['head']) {\n    method = 'get';\n  }\n  req.route = this;\n  next();\n  function next(err) {\n    if (err && err === 'route') {\n      return done();\n    }\n    if (err && err === 'router') {\n      return done(err);\n    }\n    var layer = stack[idx++];\n    if (!layer) {\n      return done(err);\n    }\n    if (layer.method && layer.method !== method) {\n      return next(err);\n    }\n    if (err) {\n      layer.handle_error(err, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n};\nRoute.prototype.all = function all() {\n  var handles = flatten(slice.call(arguments));\n  for (var i = 0; i < handles.length; i++) {\n    var handle = handles[i];\n    if (typeof handle !== 'function') {\n      var type = toString.call(handle);\n      var msg = 'Route.all() requires a callback function but got a ' + type;\n      throw new TypeError(msg);\n    }\n    var layer = Layer('/', {}, handle);\n    layer.method = undefined;\n    this.methods._all = true;\n    this.stack.push(layer);\n  }\n  return this;\n};\nmethods.forEach(function (method) {\n  Route.prototype[method] = function () {\n    var handles = flatten(slice.call(arguments));\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type;\n        throw new Error(msg);\n      }\n      debug('%s %o', method, this.path);\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n    return this;\n  };\n});\n"}