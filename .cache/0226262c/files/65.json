{"contents":"var paramRegExp = /; *([!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+) *= *(\"(?:[ !\\u0023-\\u005b\\u005d-\\u007e\\u0080-\\u00ff]|\\\\[\\u0020-\\u007e])*\"|[!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+) */g;\nvar textRegExp = /^[\\u0020-\\u007e\\u0080-\\u00ff]+$/;\nvar tokenRegExp = /^[!#$%&'\\*\\+\\-\\.0-9A-Z\\^_`a-z\\|~]+$/;\nvar qescRegExp = /\\\\([\\u0000-\\u007f])/g;\nvar quoteRegExp = /([\\\\\"])/g;\nvar subtypeNameRegExp = /^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/;\nvar typeNameRegExp = /^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/;\nvar typeRegExp = /^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;\nexports.format = format;\nexports.parse = parse;\nfunction format(obj) {\n  if (!obj || typeof obj !== 'object') {\n    throw new TypeError('argument obj is required');\n  }\n  var parameters = obj.parameters;\n  var subtype = obj.subtype;\n  var suffix = obj.suffix;\n  var type = obj.type;\n  if (!type || !typeNameRegExp.test(type)) {\n    throw new TypeError('invalid type');\n  }\n  if (!subtype || !subtypeNameRegExp.test(subtype)) {\n    throw new TypeError('invalid subtype');\n  }\n  var string = type + '/' + subtype;\n  if (suffix) {\n    if (!typeNameRegExp.test(suffix)) {\n      throw new TypeError('invalid suffix');\n    }\n    string += '+' + suffix;\n  }\n  if (parameters && typeof parameters === 'object') {\n    var param;\n    var params = Object.keys(parameters).sort();\n    for (var i = 0; i < params.length; i++) {\n      param = params[i];\n      if (!tokenRegExp.test(param)) {\n        throw new TypeError('invalid parameter name');\n      }\n      string += '; ' + param + '=' + qstring(parameters[param]);\n    }\n  }\n  return string;\n}\nfunction parse(string) {\n  if (!string) {\n    throw new TypeError('argument string is required');\n  }\n  if (typeof string === 'object') {\n    string = getcontenttype(string);\n  }\n  if (typeof string !== 'string') {\n    throw new TypeError('argument string is required to be a string');\n  }\n  var index = string.indexOf(';');\n  var type = index !== -1 ? string.substr(0, index) : string;\n  var key;\n  var match;\n  var obj = splitType(type);\n  var params = {};\n  var value;\n  paramRegExp.lastIndex = index;\n  while (match = paramRegExp.exec(string)) {\n    if (match.index !== index) {\n      throw new TypeError('invalid parameter format');\n    }\n    index += match[0].length;\n    key = match[1].toLowerCase();\n    value = match[2];\n    if (value[0] === '\"') {\n      value = value.substr(1, value.length - 2).replace(qescRegExp, '$1');\n    }\n    params[key] = value;\n  }\n  if (index !== -1 && index !== string.length) {\n    throw new TypeError('invalid parameter format');\n  }\n  obj.parameters = params;\n  return obj;\n}\nfunction getcontenttype(obj) {\n  if (typeof obj.getHeader === 'function') {\n    return obj.getHeader('content-type');\n  }\n  if (typeof obj.headers === 'object') {\n    return obj.headers && obj.headers['content-type'];\n  }\n}\nfunction qstring(val) {\n  var str = String(val);\n  if (tokenRegExp.test(str)) {\n    return str;\n  }\n  if (str.length > 0 && !textRegExp.test(str)) {\n    throw new TypeError('invalid parameter value');\n  }\n  return '\"' + str.replace(quoteRegExp, '\\\\$1') + '\"';\n}\nfunction splitType(string) {\n  var match = typeRegExp.exec(string.toLowerCase());\n  if (!match) {\n    throw new TypeError('invalid media type');\n  }\n  var type = match[1];\n  var subtype = match[2];\n  var suffix;\n  var index = subtype.lastIndexOf('+');\n  if (index !== -1) {\n    suffix = subtype.substr(index + 1);\n    subtype = subtype.substr(0, index);\n  }\n  var obj = {\n    type: type,\n    subtype: subtype,\n    suffix: suffix\n  };\n  return obj;\n}\n"}