{"version":3,"sources":["public/src/presenter.ts","public/src/receptorClient.ts","public/src/components/utils.ts"],"names":["constructor","rec","roomKey","mensajes","queue","raw","stoped","listennerMode","elements","__title","div","utils_1","width","height","className","id","header","append","title","margin","innerHTML","roomData","roomId","svg","paddingLeft","classList","add","src","onclick","document","documentElement","requestFullscreen","timeCounter","fontSize","fontWeight","control","stopButton","remove","console","log","stop","irAlEditor","location","href","transmissionContainner","maxHeight","color","display","flexDirection","overflow","style","scrollBehavior","body","value","timeElapsed","toString","render","length","mensaje","splice","marginRight","result","scrollTo","top","scrollHeight","data","push","error","resume","presenter","presenter_1","socket","io","on","pathname","Error","info","eventTitle","split","slice","emit","connect","pixelFields","Object","keys","forEach","k","is_number","indexOf","type","styleOrClass","__style","__className","createElement","applyStyle"],"mappings":"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","file":"","sourcesContent":["import { createDiv, createElement } from \"./components/utils\"\r\ndeclare const roomId: string;\r\n\r\nexport class Presenter {\r\n    transmissionContainner: HTMLDivElement;\r\n    control: HTMLDivElement;\r\n    mensajes: {[id: string]: HTMLDivElement} = {}\r\n    queue: {result: string, id: string}[] = []\r\n    raw: string = \"\"\r\n    stoped: boolean = false;\r\n    listennerMode: boolean = true;\r\n\r\n    elements: {title?: HTMLElement, roomData?: HTMLElement, timeCounter?: HTMLElement} = {}\r\n\r\n    private __title = \"\";\r\n    constructor( rec?, roomKey?: string) {\r\n        var div = createDiv({width: \"100%\", height: \"100%\"})\r\n        div.className=\"msgContainner\";\r\n        div.id = \"core\"\r\n\r\n        var header = createDiv(\"header\")\r\n        div.append(header)\r\n\r\n        let title = createElement(\"h2\", {margin: \"15px 0\"})\r\n        title.innerHTML = ``;       \r\n        header.append(title)\r\n        this.elements.title = title;\r\n\r\n        let roomData = createDiv({margin: \"15px 0\"})\r\n        roomData.innerHTML = `Id de la sala: ${roomId}`;  \r\n        let svg = createElement(\"img\",  {paddingLeft: 10}) as HTMLImageElement;\r\n        svg.classList.add(\"fullscreen\")\r\n        svg.src = \"/images/fullscreen.svg\";\r\n        svg.onclick = () => {\r\n            document.documentElement.requestFullscreen()\r\n        }\r\n        roomData.append(svg)     \r\n        header.append(roomData)\r\n        this.elements.roomData = roomData;\r\n\r\n        let timeCounter = createDiv({margin: \"15px 0\", fontSize: 30, fontWeight: 600})\r\n        timeCounter.innerHTML = ``;       \r\n        header.append(timeCounter)\r\n        this.elements.timeCounter = timeCounter;\r\n\r\n\r\n        if (rec) this.listennerMode = false;\r\n\r\n        this.control = createDiv(\"navigation\")\r\n        var stopButton = createElement(\"button\")\r\n        stopButton.innerHTML = \"STOP\"\r\n        stopButton.onclick = () => {\r\n            if (this.stoped && this.listennerMode) {\r\n                stopButton.classList.remove(\"disabled\")\r\n                stopButton.innerHTML = \"STOP\"\r\n                this.stoped = false;\r\n            } else {\r\n                stopButton.classList.add(\"disabled\")\r\n                stopButton.innerHTML = \"RESTART\"\r\n                this.stoped = true;\r\n            }\r\n           \r\n            if(rec) {\r\n                console.log(\"STOP RECORDER\", rec);\r\n                rec.stop();\r\n\r\n                var irAlEditor = createElement(\"button\");\r\n                irAlEditor.innerHTML = \"Ir al editor\";\r\n                irAlEditor.onclick = () => {\r\n                    location.href = `/editor/${roomKey}`;\r\n                }\r\n                this.control.append(irAlEditor);\r\n            }\r\n        }\r\n        this.control.append(stopButton)\r\n\r\n        \r\n\r\n\r\n        div.append(this.control)\r\n\r\n        this.transmissionContainner = createDiv(\"transcripciones\", {width: 400, maxHeight: 200,  margin: \"auto auto\", color: \"#ffffff\", fontSize: 20, \r\n        display: \"flex\", flexDirection: \"column\", overflow: \"hidden\"})\r\n        this.transmissionContainner.style.scrollBehavior = \"smooth\";\r\n        div.append(this.transmissionContainner)\r\n\r\n        document.body.append(div)\r\n    }\r\n\r\n    set title(value: string) {\r\n        this.__title = value;\r\n        this.elements.title.innerHTML = value;\r\n    }\r\n    set timeElapsed(value: number) {\r\n        this.elements.timeCounter.innerHTML = (value / 1000 | 0).toString();\r\n    }\r\n\r\n    private render() {\r\n        if (this.listennerMode == true && this.stoped) return;\r\n        while(this.queue.length) {\r\n        \r\n            var mensaje = this.queue.splice(0, 1)[0];\r\n            console.log(mensaje, this.queue)\r\n            if (!this.mensajes[mensaje.id]) {\r\n                var div = createDiv(\"textRow\",{ marginRight: \"4pt\"});\r\n                this.transmissionContainner.append(div);\r\n                this.mensajes[mensaje.id] = div;\r\n                this.mensajes[mensaje.id].innerHTML = mensaje.result;\r\n                this.transmissionContainner.scrollTo({top: this.transmissionContainner.scrollHeight})\r\n            } else {\r\n                this.mensajes[mensaje.id].innerHTML = mensaje.result;\r\n                this.transmissionContainner.scrollTo({top: this.transmissionContainner.scrollHeight})\r\n            }\r\n        }\r\n     \r\n    }\r\n    append(data: {result: string, id: string}) {\r\n        if (data) {\r\n            this.queue.push(data)   \r\n            this.render();  \r\n        } else {\r\n            console.error(\"Append null\")\r\n        }\r\n\r\n    }\r\n    stop() {\r\n        this.stoped = true;\r\n    }\r\n    resume() {\r\n        this.stoped = false;\r\n        this.render();\r\n    }\r\n}\r\n","import { Presenter } from \"./presenter\";\r\ndeclare const io : typeof import(\"socket.io-client\").default\r\nvar presenter = new Presenter()\r\n\r\n\r\nvar socket = io()\r\n\r\n\r\nsocket.on(\"disconnect\", () => {\r\n    console.log(\"disconected\")\r\n})\r\nsocket.on(\"connect\", () => {\r\n    var roomId = location.pathname || \"\"\r\n    if (roomId.length < 2) {\r\n        throw new Error(\"sala invalida\")\r\n    }\r\n\r\n    socket.on(\"info\", (info: {photoUrl: string, eventTitle: string}) => {\r\n        presenter.title = info.eventTitle;\r\n    })\r\n    roomId = roomId.split(\"/\").slice(2)[0];\r\n    socket.emit(\"join\", {roomId: roomId});  \r\n\r\n})\r\n\r\n\r\nsocket.on(\"joined\",  (roomId) => {\r\n    socket.on(\"mensaje\", data => {\r\n        presenter.append(data)\r\n    })\r\n  \r\n    console.log(\"Joined to room\")\r\n});  \r\n\r\nsocket.connect()","const pixelFields = [\"margin\", \"marginLeft\", \"marginRight\", \"marginTop\",\"marginBottom\", \r\n    \"padding\", \"paddingLeft\", \"paddingRight\", \"paddingTop\",\"paddingBottom\",\r\n    \"left\", \"top\", \"right\", \"bottom\",\"width\",\"height\", \"minWidth\", \"minHeight\", \r\n    \"maxWidth\", \"maxHeight\", \"borderWidth\"]\r\nexport function applyStyle(div: HTMLElement, style: any) {\r\n    Object.keys(style || {}).forEach(k => {\r\n        let is_number = pixelFields.indexOf(k) >= 0\r\n        if (is_number && typeof style[k] == \"number\") div.style[k] = style[k]+\"px\"\r\n        else div.style[k] = style[k]\r\n   \r\n    })\r\n}\r\n\r\n\r\ninterface  ICreateElement {\r\n    (type: \"button\", styleOrClass?: string | object, style?: object): HTMLButtonElement;\r\n    (type: \"div\", styleOrClass?: string | object, style?: object): HTMLDivElement;\r\n    (type: string, styleOrClass?: string | object, style?: object): HTMLElement;\r\n}\r\nexport const createElement: ICreateElement = (type: string, styleOrClass?: string | object, style?: object) => {\r\n    var __style = typeof styleOrClass == \"object\"? styleOrClass : style || {}\r\n    var __className = typeof styleOrClass == \"string\"? styleOrClass : \"\"\r\n    var div = document.createElement(type)\r\n    div.className = __className\r\n    applyStyle(div, __style)\r\n    return div as any\r\n} \r\n\r\nexport function createDiv(styleOrClass?: string | object, style?: object) {\r\n    var __style = typeof styleOrClass == \"object\"? styleOrClass : style || {}\r\n    var __className = typeof styleOrClass == \"string\"? styleOrClass : \"\"\r\n    var div = document.createElement(\"div\")\r\n    div.className = __className\r\n    applyStyle(div, __style)\r\n    return div\r\n}\r\n"]}